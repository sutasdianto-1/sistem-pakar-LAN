<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Diagnosa Gangguan LAN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ================= NAVBAR ================= -->
<header class="navbar">
  <div class="logo">
    <img src="assets/logo.png" alt="Logo" class="logo-img">
    <h2>Sistem Pakar<br><span>Diagnosa Kerusakan Komputer</span></h2>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="diagnosa.html" class="active">Diagnosa</a>
    <a href="about.html">About</a>
    <a href="diagram-tree.html">Diagram Tree</a>
    <a href="implikasi.html">Implikasi</a>
  </nav>

</header>

<!-- ================= CONTAINER ================= -->
<main class="container">
  <div class="title">Diagnosa Jaringan LAN</div>

  <div id="questionBox" class="question"></div>

  <div class="buttons">
    <button class="submit" onclick="answer(true)">Ya</button>
    <button class="back" onclick="answer(false)">Tidak</button>
  </div>

  <div class="hasil" id="hasil"></div>
</main>

<!-- ================= SCRIPT ================= -->
<script>
/* =================================================
   DECISION TREE (FORWARD CHAINING)
   ================================================= */
const tree = {
  G01: { q: "Apakah jaringan tidak connect?", y: "G11", n: "G02" },
  G11: { q: "Apakah lampu indikator switch mati?", y: "G12", n: "G13" },
  G12: { q: "Apakah lampu indikator workstation mati?", y: "E09", n: "G13" },
  G13: { q: "Apakah kabel tidak terpasang dengan baik?", y: "E10", n: "G14" },
  G14: { q: "Apakah lampu indikator LAN Card mati?", y: "E01", n: "G15" },
  G15: { q: "Apakah IP Address menggunakan setting statis?", y: "E11", n: "G16" },
  G16: { q: "Apakah terdapat nama komputer yang sama?", y: "E12", n: "G17" },
  G17: { q: "Apakah terdapat kesalahan setting Mikrotik?", y: "E13", n: "G18" },
  G18: { q: "Apakah terdapat kesalahan setting DHCP?", y: "E13", n: "E00" },

  G02: { q: "Apakah jaringan terasa lambat?", y: "G03", n: "G05" },
  G03: { q: "Apakah jaringan lambat hanya pada 1 PC?", y: "E01", n: "G04" },
  G04: { q: "Apakah lalu lintas jaringan padat?", y: "E02", n: "E03" },

  G05: { q: "Apakah tidak bisa membuka file dalam jaringan?", y: "E04", n: "G06" },
  G06: { q: "Apakah printer tidak bisa mencetak?", y: "G07", n: "E00" },
  G07: { q: "Apakah tombol power printer mati?", y: "E05", n: "G08" },
  G08: { q: "Apakah printer tidak terhubung dengan benar?", y: "E06", n: "G09" },
  G09: { q: "Apakah printer belum diinstall di server?", y: "E08", n: "G10" },
  G10: { q: "Apakah nama printer tidak ada dalam jaringan?", y: "E07", n: "E06" }
};

/* =================================================
   KESIMPULAN (KODE GANGGUAN)
   ================================================= */
const result = {
  E00: "Tidak ditemukan kerusakan jaringan",
  E01: "E01 – Kabel / LAN Card pada PC rusak",
  E02: "E02 – Bandwidth tidak memadai",
  E03: "E03 – Konfigurasi jaringan salah",
  E04: "E04 – File sharing belum aktif",
  E05: "E05 – Printer belum dinyalakan",
  E06: "E06 – Printer belum dihubungkan ke server",
  E07: "E07 – Setting printer di komputer salah",
  E08: "E08 – Printer belum diinstall di server",
  E09: "E09 – Switch rusak",
  E10: "E10 – Kabel longgar / putus / salah",
  E11: "E11 – IP Address Conflict",
  E12: "E12 – Duplicate Name Exists on the Network",
  E13: "E13 – Limited or No Connectivity"
};

let currentNode = "G01";
let path = []; // menyimpan gejala yang dijawab YA

/* =================================================
   RENDER QUESTION (DENGAN KODE GEJALA)
   ================================================= */
function renderQuestion() {
  const kode = currentNode;
  const teks = tree[currentNode].q;

  document.getElementById("questionBox").innerHTML =
    `<label><b>${kode}</b> – ${teks}</label>`;
}

/* =================================================
   HANDLE ANSWER
   ================================================= */
function answer(isYes) {
  if (isYes && currentNode.startsWith("G")) {
    path.push(currentNode);
  }

  const next = isYes ? tree[currentNode].y : tree[currentNode].n;

  if (next.startsWith("E")) {
    showResult(next);
  } else {
    currentNode = next;
    renderQuestion();
  }
}

/* =================================================
   SHOW RESULT (EXPLAINABLE)
   ================================================= */
function showResult(code) {
  const hasilBox = document.getElementById("hasil");
  hasilBox.style.display = "block";

  // Susun data untuk dikirim ke halaman implikasi
  const dataDiagnosa = {
    kodeGangguan: code,
    namaGangguan: result[code],
    gejala: path.map(g => ({
      kode: g,
      nama: tree[g].q.replace("Apakah ","").replace("?","")
    }))
  };

  // SIMPAN ke localStorage
  localStorage.setItem("hasilDiagnosa", JSON.stringify(dataDiagnosa));

  // TAMPILKAN di halaman diagnosa (tetap)
  let html = `<b>Hasil Diagnosa:</b><br>`;
  html += `<b>${result[code]}</b><br><br>`;
  html += `<b>Gejala yang terpenuhi:</b><ul>`;

  dataDiagnosa.gejala.forEach(g => {
    html += `<li>${g.kode} – ${g.nama}</li>`;
  });

  html += `</ul>`;
  html += `<b>Kesimpulan:</b><br>`;
  html += `Gangguan <b>${code}</b> disimpulkan karena seluruh gejala terpenuhi.`;

  hasilBox.innerHTML = html;

  // ARAHKAN ke halaman implikasi (opsional)
  setTimeout(() => {
    window.location.href = "implikasi.html";
  }, 1500);
}

/* INIT */
renderQuestion();
</script>

</body>
</html>
